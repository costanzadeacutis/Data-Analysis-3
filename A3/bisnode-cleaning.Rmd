---
title: "A3prova"
author: "costanzadeacutis"
date: "2023-02-24"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
rm(list=ls())

# Import libraries
library(haven)
library(glmnet)
library(purrr)
library(margins)
library(skimr)
library(kableExtra)
library(Hmisc)
library(cowplot)
library(gmodels) 
library(lspline)
library(sandwich)
library(modelsummary)

library(rattle)
library(caret)
library(pROC)
library(ranger)
library(rpart)
library(partykit)
library(rpart.plot)

# load theme and functions
source("~/subdirectory/Assignment3/A3/A3/theme_bg.R") 
source("~/subdirectory/Assignment3/A3/A3/functions.R")

data_in <- "~/subdirectory/Assignment3/A3/A3"
data_out <- "~/subdirectory/Assignment3/A3/A3"
output <- "~/subdirectory/Assignment3/A3/A3/output/"
create_output_if_doesnt_exist(output)

knitr::opts_chunk$set(echo = TRUE)
```

# DATA PREPARATION

## Import data
I import dataset cs_bisnode_panel.csv which provides information on Scandinavian owned companies. I drop those variables with too many missing values and I retain only firm-year observations between 2010 and 2015.

```{r import, warning=FALSE}
data <- read_csv(paste(data_in,"cs_bisnode_panel.csv", sep = "/"))

# drop variables with many NAs
data <- data %>%
  select(-c(COGS, finished_prod, net_dom_sales, net_exp_sales, wages)) %>%
  filter(year !=2016)

#panel to use
data <- data %>%
  filter(year >= 2010,
         year <= 2015)
```

## Label engineering
I add the missing year and company id combinations; I also identify the companies that are "alive", i.e. sales greater than 0 and no missing value for sales 

```{r}
# add all missing year and comp_id combinations -
# originally missing combinations will have NAs in all other columns
data <- data %>%
  complete(year, comp_id)

# generate status_alive; if sales larger than zero and not-NA, then firm is alive
data  <- data %>%
  mutate(status_alive = sales > 0 & !is.na(sales) %>%
           as.numeric(.))

```
